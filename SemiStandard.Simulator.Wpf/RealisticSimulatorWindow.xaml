<Window x:Class="SemiStandard.Simulator.Wpf.RealisticSimulatorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:oxy="http://oxyplot.org/wpf"
        mc:Ignorable="d"
        Title="Photolithography Equipment Simulator - ASML-XT1900Gi"
        Height="900" Width="1600"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="{DynamicResource MaterialDesignFont}"
        WindowStartupLocation="CenterScreen">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryDark" Padding="16">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Chip" Width="32" Height="32" VerticalAlignment="Center"/>
                    <TextBlock Text="ASML-XT1900Gi Photolithography Simulator" 
                               VerticalAlignment="Center" Margin="16,0,0,0" 
                               FontSize="20" FontWeight="Medium"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock Text="Equipment State:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock x:Name="EquipmentStateText" Text="OFFLINE" 
                               VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,16,0"/>
                    <TextBlock Text="Process State:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBlock x:Name="ProcessStateText" Text="IDLE" 
                               VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,16,0"/>
                    <Button x:Name="ConnectButton" Content="CONNECT" 
                            Background="DodgerBlue" Foreground="White"
                            Click="ConnectButton_Click" Margin="8,0,0,0" Padding="16,8"/>
                </StackPanel>
            </Grid>
        </materialDesign:ColorZone>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="400"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Control & Carrier Management -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Equipment Control -->
                <materialDesign:Card Grid.Row="0" Margin="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Equipment Control" FontSize="16" FontWeight="Medium" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <Button x:Name="InitButton" Grid.Column="0" Grid.Row="0" Content="INITIALIZE" 
                                    Margin="2" Click="InitButton_Click"/>
                            <Button x:Name="RemoteButton" Grid.Column="1" Grid.Row="0" Content="REMOTE" 
                                    Margin="2" Click="RemoteButton_Click"/>
                            <Button x:Name="StartButton" Grid.Column="0" Grid.Row="1" Content="START" 
                                    Margin="2" Background="Green" Foreground="White"
                                    Click="StartButton_Click"/>
                            <Button x:Name="StopButton" Grid.Column="1" Grid.Row="1" Content="STOP" 
                                    Margin="2" Background="Red" Foreground="White"
                                    Click="StopButton_Click"/>
                            <Button x:Name="PauseButton" Grid.Column="0" Grid.Row="2" Content="PAUSE" 
                                    Margin="2" Click="PauseButton_Click"/>
                            <Button x:Name="ResumeButton" Grid.Column="1" Grid.Row="2" Content="RESUME" 
                                    Margin="2" Click="ResumeButton_Click"/>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Carrier Management -->
                <materialDesign:Card Grid.Row="1" Margin="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Carrier Management" FontSize="16" FontWeight="Medium" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Carrier ID:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="CarrierIdTextBox" Grid.Row="0" Grid.Column="1" Text="LOT001" Margin="0,4"/>
                            <ComboBox x:Name="LoadPortComboBox" Grid.Row="0" Grid.Column="2" Width="60" Margin="4">
                                <ComboBoxItem Content="LP1" IsSelected="True"/>
                                <ComboBoxItem Content="LP2"/>
                                <ComboBoxItem Content="LP3"/>
                            </ComboBox>

                            <Button Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Content="LOAD CARRIER" 
                                    x:Name="LoadCarrierButton" Click="LoadCarrierButton_Click" Margin="0,4"/>
                            <Button Grid.Row="1" Grid.Column="2" Content="MAP" 
                                    x:Name="MapButton" Click="MapButton_Click" Margin="4"/>

                            <Button Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3" Content="UNLOAD CARRIER" 
                                    x:Name="UnloadCarrierButton" Click="UnloadCarrierButton_Click" Margin="0,4"/>
                        </Grid>

                        <!-- Carrier Status List -->
                        <TextBlock Text="Loaded Carriers:" Margin="0,12,0,4"/>
                        <ListBox x:Name="CarrierListBox" Height="120">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="4">
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="40"/>
                                                <ColumnDefinition Width="80"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Grid.Column="0" Text="{Binding CarrierId}" FontWeight="Bold"/>
                                            <TextBlock Grid.Column="1" Text="{Binding LoadPort}"/>
                                            <TextBlock Grid.Column="2" Text="{Binding State}"/>
                                            <TextBlock Grid.Column="3" Text="{Binding StatusText}" FontSize="11"/>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Recipe Selection -->
                <materialDesign:Card Grid.Row="2" Margin="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Recipe Selection" FontSize="16" FontWeight="Medium" Margin="0,0,0,12"/>
                        <ComboBox x:Name="RecipeComboBox" materialDesign:HintAssist.Hint="Select Recipe">
                            <ComboBoxItem Content="PROC_193NM_STD - 193nm Standard Process" IsSelected="True"/>
                            <ComboBoxItem Content="PROC_193NM_CRIT - 193nm Critical Layer"/>
                            <ComboBoxItem Content="PROC_193NM_CONTACT - 193nm Contact Holes"/>
                        </ComboBox>
                        <Button x:Name="LoadRecipeButton" Content="LOAD RECIPE" Margin="0,8,0,0" Click="LoadRecipeButton_Click"/>
                        <TextBlock x:Name="CurrentRecipeText" Text="Current: None" Margin="0,8,0,0" FontStyle="Italic"/>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Statistics -->
                <materialDesign:Card Grid.Row="3" Margin="8" Padding="16">
                    <StackPanel>
                        <TextBlock Text="Production Statistics" FontSize="16" FontWeight="Medium" Margin="0,0,0,12"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Total Processed:" Margin="0,2"/>
                            <TextBlock Grid.Row="0" Grid.Column="1" x:Name="TotalProcessedText" Text="0" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,2"/>

                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Total Failed:" Margin="0,2"/>
                            <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TotalFailedText" Text="0" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,2" Foreground="Red"/>

                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Yield:" Margin="0,2"/>
                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="YieldText" Text="0.0%" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,2" Foreground="Green"/>

                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Throughput:" Margin="0,2"/>
                            <TextBlock Grid.Row="3" Grid.Column="1" x:Name="ThroughputText" Text="0 WPH" FontWeight="Bold" HorizontalAlignment="Right" Margin="0,2"/>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>

            <!-- Center Panel: Process Monitoring & State Logs -->
            <TabControl Grid.Column="1" Margin="4">
                <!-- Process Monitoring Tab -->
                <TabItem Header="Process Monitoring">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="300"/>
                            <RowDefinition Height="300"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Temperature & Pressure Charts -->
                        <materialDesign:Card Grid.Row="0" Margin="8" Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Text="Process Parameters" FontSize="16" FontWeight="Medium" Margin="0,0,0,8"/>
                                <Grid Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition/>
                                        <ColumnDefinition/>
                                    </Grid.ColumnDefinitions>

                                    <oxy:PlotView Grid.Column="0" x:Name="TemperaturePlot" Margin="4"/>
                                    <oxy:PlotView Grid.Column="1" x:Name="PressurePlot" Margin="4"/>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Wafer Processing Visualization -->
                        <materialDesign:Card Grid.Row="1" Margin="8" Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Text="Wafer Processing Status" FontSize="16" FontWeight="Medium" Margin="0,0,0,8"/>

                                <!-- Wafer Map Grid -->
                                <Grid Grid.Row="1" x:Name="WaferMapGrid">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Current Wafer Info -->
                                    <StackPanel Grid.Column="0" Margin="0,0,16,0" VerticalAlignment="Center">
                                        <TextBlock Text="Current Wafer" FontWeight="Bold" Margin="0,4"/>
                                        <TextBlock x:Name="CurrentWaferIdText" Text="None" Margin="0,2"/>
                                        <TextBlock x:Name="CurrentWaferSlotText" Text="Slot: -" Margin="0,2"/>
                                        <TextBlock x:Name="CurrentWaferStatusText" Text="Status: -" Margin="0,2"/>
                                        <ProgressBar x:Name="WaferProgressBar" Height="20" Margin="0,8" Value="0"/>
                                    </StackPanel>

                                    <!-- Wafer Map Visual -->
                                    <Grid Grid.Column="1" x:Name="WaferSlotGrid">
                                        <!-- Will be populated dynamically with 25 slot indicators -->
                                    </Grid>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Process Timeline -->
                        <materialDesign:Card Grid.Row="2" Margin="8" Padding="16">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <TextBlock Grid.Row="0" Text="Process Timeline" FontSize="16" FontWeight="Medium" Margin="0,0,0,8"/>
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="TimelineItemsControl">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="4,2">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="80"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock Grid.Column="0" Text="{Binding Timestamp}" FontSize="10" Foreground="Gray"/>
                                                        <TextBlock Grid.Column="1" Text="{Binding Message}" FontSize="11"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>

                <!-- XStateNet State Log Tab -->
                <TabItem Header="XStateNet State Log">
                    <Grid Background="Black">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header with controls -->
                        <materialDesign:Card Grid.Row="0" Margin="8" Padding="12" Background="#1A1A1A">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- First row: Title and main controls -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="State Machine Transitions" 
                                              FontSize="16" FontWeight="Medium" VerticalAlignment="Center" Foreground="White"/>

                                    <CheckBox Grid.Column="1" x:Name="AutoScrollCheckBox" 
                                             Content="Auto-scroll" IsChecked="True" 
                                             VerticalAlignment="Center" Margin="0,0,16,0" Foreground="LightGray"/>

                                    <Button Grid.Column="2" x:Name="ClearStateLogButton" 
                                           Content="CLEAR" Click="ClearStateLogButton_Click"
                                           Background="#333333" Foreground="White" BorderThickness="0" Margin="0,0,8,0"/>

                                    <Button Grid.Column="3" x:Name="ExportStateLogButton" 
                                           Content="EXPORT" Click="ExportStateLogButton_Click"
                                           Background="Green" Foreground="White"/>
                                </Grid>

                                <!-- Second row: State machine filters -->
                                <Grid Grid.Row="1" Margin="0,8,0,0" MinHeight="60">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <DockPanel Grid.Column="0">
                                        <TextBlock Text="Filter:" VerticalAlignment="Top" Foreground="Gray" Margin="0,4,12,0" DockPanel.Dock="Left"/>

                                        <WrapPanel Orientation="Horizontal" VerticalAlignment="Top">
                                            <CheckBox x:Name="FilterEquipmentController" 
                                                     IsChecked="True" Foreground="DeepSkyBlue" 
                                                     Margin="0,2,20,2" Width="140"
                                                     Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Equipment&#x0a;Controller" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterProcessManager" 
                                                     IsChecked="True" Foreground="LimeGreen" 
                                                     Margin="0,2,20,2" Width="120"
                                                     Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Process&#x0a;Manager" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterTransportHandler" 
                                                     IsChecked="True" Foreground="Orange" 
                                                     Margin="0,2,20,2" Width="120"
                                                     Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Transport&#x0a;Handler" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterRecipeExecutor" 
                                                     IsChecked="True" Foreground="MediumPurple" 
                                                     Margin="0,2,20,2" Width="120"
                                                     Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Recipe&#x0a;Executor" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <Button x:Name="SelectAllButton" Content="All" 
                                                   Click="SelectAllButton_Click" Background="#444444" 
                                                   Foreground="White" Padding="8,2" Margin="8,2,4,2"
                                                   Height="24" VerticalAlignment="Top"/>

                                            <Button x:Name="SelectNoneButton" Content="None" 
                                                   Click="SelectNoneButton_Click" Background="#444444" 
                                                   Foreground="White" Padding="8,2" Margin="0,2"
                                                   Height="24" VerticalAlignment="Top"/>
                                        </WrapPanel>
                                    </DockPanel>

                                    <!-- State-Time Chart Controls -->
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                                        <TextBlock Text="Analyze:" VerticalAlignment="Center" Foreground="Gray" Margin="0,0,8,0"/>

                                        <Button x:Name="ShowUmlTimingButton" Content="ðŸŠ UML TIMING" 
                                               Click="ShowUmlTimingButton_Click" 
                                               Background="#03DAC6" Foreground="Black" 
                                               Padding="12,4" FontWeight="Bold"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>

                        <!-- State Log Display -->
                        <materialDesign:Card Grid.Row="1" Margin="8" Padding="12" Background="#0A0A0A">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <ScrollViewer x:Name="StateLogScrollViewer" VerticalScrollBarVisibility="Auto" Background="Black">
                                    <ItemsControl x:Name="StateLogItemsControl">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderBrush="#222222" 
                                                       BorderThickness="0,0,0,1" 
                                                       Background="Transparent"
                                                       Padding="8,6" Margin="0,2"
                                                       Visibility="{Binding Visibility}">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="100"/>
                                                            <ColumnDefinition Width="150"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <!-- Timestamp -->
                                                        <TextBlock Grid.Column="0" Text="{Binding Timestamp}" 
                                                                  FontFamily="Consolas" FontSize="11" 
                                                                  Foreground="#606060" VerticalAlignment="Center"/>

                                                        <!-- State Machine Name (Clickable) -->
                                                        <TextBlock Grid.Column="1" Text="{Binding StateMachine}" 
                                                                  FontWeight="Bold" FontSize="12" 
                                                                  Foreground="{Binding MachineColor}" 
                                                                  VerticalAlignment="Center" Margin="12,0"
                                                                  Cursor="Hand"
                                                                  TextDecorations="Underline"
                                                                  MouseLeftButtonDown="StateMachineName_Click"
                                                                  ToolTip="Click to view XState script"/>

                                                        <!-- State Transition in format: (from) -> event/guard -> (to) -->
                                                        <TextBlock Grid.Column="2" FontFamily="Consolas" FontSize="12" 
                                                                  VerticalAlignment="Center">
                                                            <TextBlock.Inlines>
                                                                <Run Text="(" Foreground="#808080"/>
                                                                <Run Text="{Binding FromState, Mode=OneWay}" Foreground="{Binding FromStateColor, Mode=OneWay}" FontWeight="Bold"/>
                                                                <Run Text=")" Foreground="#808080"/>
                                                                <Run Text=" â†’ " Foreground="Cyan" FontWeight="Bold"/>
                                                                <Run Text="{Binding TransitionLabel, Mode=OneWay}" Foreground="#BB86FC" FontStyle="Italic"/>
                                                                <Run Text=" â†’ " Foreground="Cyan" FontWeight="Bold"/>
                                                                <Run Text="(" Foreground="#808080"/>
                                                                <Run Text="{Binding ToState, Mode=OneWay}" Foreground="{Binding ToStateColor, Mode=OneWay}" FontWeight="Bold"/>
                                                                <Run Text=")" Foreground="#808080"/>
                                                            </TextBlock.Inlines>
                                                        </TextBlock>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Grid>
                        </materialDesign:Card>

                        <!-- Statistics Panel -->
                        <materialDesign:Card Grid.Row="2" Margin="8" Padding="12" Background="#1A1A1A">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <TextBlock Text="Total Transitions: " FontSize="11" Foreground="LightGray"/>
                                    <TextBlock x:Name="TotalTransitionsText" Text="0" 
                                              FontWeight="Bold" FontSize="11" Foreground="Cyan"/>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Orientation="Horizontal">
                                    <TextBlock Text="Active States: " FontSize="11" Foreground="LightGray"/>
                                    <TextBlock x:Name="ActiveStatesText" Text="0" 
                                              FontWeight="Bold" FontSize="11" Foreground="Lime"/>
                                </StackPanel>

                                <StackPanel Grid.Column="2" Orientation="Horizontal">
                                    <TextBlock Text="Events/sec: " FontSize="11" Foreground="LightGray"/>
                                    <TextBlock x:Name="EventRateText" Text="0.0" 
                                              FontWeight="Bold" FontSize="11" Foreground="Gold"/>
                                </StackPanel>

                                <StackPanel Grid.Column="3" Orientation="Horizontal">
                                    <TextBlock Text="Uptime: " FontSize="11" Foreground="LightGray"/>
                                    <TextBlock x:Name="UptimeText" Text="00:00:00" 
                                              FontWeight="Bold" FontSize="11" Foreground="#BB86FC"/>
                                </StackPanel>
                            </Grid>
                        </materialDesign:Card>
                        <materialDesign:Card Grid.Row="0" Margin="8,8,8,8" Padding="12" Background="#1A1A1A">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- First row: Title and main controls -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" Text="State Machine Transitions" 
                                        FontSize="16" FontWeight="Medium" VerticalAlignment="Center" Foreground="White"/>

                                    <CheckBox Grid.Column="1" x:Name="AutoScrollCheckBox1" 
                                        Content="Auto-scroll" IsChecked="True" 
                                        VerticalAlignment="Center" Margin="0,0,16,0" Foreground="LightGray"/>

                                    <Button Grid.Column="2" x:Name="ClearStateLogButton1" 
                                        Content="CLEAR" Click="ClearStateLogButton_Click"
                                        Background="#333333" Foreground="White" BorderThickness="0" Margin="0,0,8,0"/>

                                    <Button Grid.Column="3" x:Name="ExportStateLogButton1" 
                                        Content="EXPORT" Click="ExportStateLogButton_Click"
                                        Background="Green" Foreground="White"/>
                                </Grid>

                                <!-- Second row: State machine filters -->
                                <Grid Grid.Row="1" Margin="0,8,0,0" MinHeight="60">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <DockPanel Grid.Column="0">
                                        <TextBlock Text="Filter:" VerticalAlignment="Top" Foreground="Gray" Margin="0,4,12,0" DockPanel.Dock="Left"/>

                                        <WrapPanel Orientation="Horizontal" VerticalAlignment="Top">
                                            <CheckBox x:Name="FilterEquipmentController1" 
                                                IsChecked="True" Foreground="DeepSkyBlue" 
                                                Margin="0,2,20,2" Width="140"
                                                Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Equipment&#xA;Controller" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterProcessManager1" 
                                                IsChecked="True" Foreground="LimeGreen" 
                                                Margin="0,2,20,2" Width="120"
                                                Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Process&#xA;Manager" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterTransportHandler1" 
                                                IsChecked="True" Foreground="Orange" 
                                                Margin="0,2,20,2" Width="120"
                                                Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Transport&#xA;Handler" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <CheckBox x:Name="FilterRecipeExecutor1" 
                                                IsChecked="True" Foreground="MediumPurple" 
                                                Margin="0,2,20,2" Width="120"
                                                Checked="FilterCheckBox_Changed" Unchecked="FilterCheckBox_Changed">
                                                <TextBlock Text="Recipe&#xA;Executor" TextWrapping="Wrap" LineHeight="14"/>
                                            </CheckBox>

                                            <Button x:Name="SelectAllButton1" Content="All" 
                                                Click="SelectAllButton_Click" Background="#444444" 
                                                Foreground="White" Padding="8,2" Margin="8,2,4,2"
                                                Height="24" VerticalAlignment="Top"/>

                                            <Button x:Name="SelectNoneButton1" Content="None" 
                                                Click="SelectNoneButton_Click" Background="#444444" 
                                                Foreground="White" Padding="8,2" Margin="0,2"
                                                Height="24" VerticalAlignment="Top"/>
                                        </WrapPanel>
                                    </DockPanel>

                                    <!-- State-Time Chart Controls -->
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0,0,0">
                                        <TextBlock Text="Analyze:" VerticalAlignment="Center" Foreground="Gray" Margin="0,0,8,0"/>

                                        <Button x:Name="ShowUmlTimingButton1" Content="ðŸŠ UML TIMING" 
                                            Click="ShowUmlTimingButton_Click" 
                                            Background="#03DAC6" Foreground="Black" 
                                            Padding="12,4" FontWeight="Bold"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </materialDesign:Card>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Right Panel: Scheduler, Events & Alarms -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" MinHeight="200" MaxHeight="300"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Scheduler Panel -->
                <materialDesign:Card Grid.Row="0" Margin="8" Padding="16">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Header -->
                        <Grid Grid.Row="0">
                            <TextBlock Text="Manufacturing Scheduler" FontSize="16" FontWeight="Medium"/>
                            <Button x:Name="AddLotButton" Content="ADD LOT" HorizontalAlignment="Right" 
                                    Background="Green" Foreground="White" Click="AddLotButton_Click"/>
                        </Grid>

                        <!-- Lot Queue Display -->
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,8,0,8">
                            <ItemsControl x:Name="SchedulerItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="LightGray" BorderThickness="0,0,0,1" Padding="4,4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="20"/>
                                                    <ColumnDefinition Width="60"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="60"/>
                                                    <ColumnDefinition Width="50"/>
                                                </Grid.ColumnDefinitions>

                                                <!-- Queue Position -->
                                                <TextBlock Grid.Column="0" Text="{Binding QueuePosition}" FontWeight="Bold" VerticalAlignment="Center"/>

                                                <!-- Lot ID -->
                                                <TextBlock Grid.Column="1" Text="{Binding LotId}" FontWeight="Bold" VerticalAlignment="Center" Margin="4,0"/>

                                                <!-- Recipe -->
                                                <TextBlock Grid.Column="2" Text="{Binding RecipeId}" FontSize="10" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>

                                                <!-- Priority -->
                                                <Border Grid.Column="3" CornerRadius="3" Padding="4,2" Margin="2,0" Background="{Binding PriorityColor}">
                                                    <TextBlock Text="{Binding Priority}" FontSize="9" HorizontalAlignment="Center" Foreground="White"/>
                                                </Border>

                                                <!-- Score -->
                                                <TextBlock Grid.Column="4" Text="{Binding Score, StringFormat='{}{0:F1}'}" FontSize="10" HorizontalAlignment="Right" VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <!-- Scheduler Metrics -->
                        <Grid Grid.Row="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" x:Name="SchedulerWaitingText" Text="Waiting: 0" FontSize="10" HorizontalAlignment="Center"/>
                            <TextBlock Grid.Column="1" x:Name="SchedulerProcessingText" Text="Processing: 0" FontSize="10" HorizontalAlignment="Center" Foreground="Blue"/>
                            <TextBlock Grid.Column="2" x:Name="SchedulerCompletedText" Text="Completed: 0" FontSize="10" HorizontalAlignment="Center" Foreground="Green"/>
                        </Grid>
                    </Grid>
                </materialDesign:Card>

                <!-- Events -->
                <materialDesign:Card Grid.Row="1" Margin="8" Padding="16">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <TextBlock Text="Events" FontSize="16" FontWeight="Medium"/>
                            <Button x:Name="ClearEventsButton" Content="CLEAR" HorizontalAlignment="Right" 
                                    Background="Transparent" BorderThickness="0" Click="ClearEventsButton_Click"/>
                        </Grid>
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
                            <ItemsControl x:Name="EventsItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding Background}" Margin="0,2" Padding="8,4" CornerRadius="4">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition/>
                                                    <RowDefinition/>
                                                </Grid.RowDefinitions>
                                                <TextBlock Grid.Row="0" FontWeight="Bold" FontSize="11">
                                                    <TextBlock.Text>
                                                        <MultiBinding StringFormat="[{0}] {1}">
                                                            <Binding Path="EventId"/>
                                                            <Binding Path="EventName"/>
                                                        </MultiBinding>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                                <TextBlock Grid.Row="1" Text="{Binding Data}" FontSize="10" TextWrapping="Wrap"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </materialDesign:Card>

                <!-- Alarms -->
                <materialDesign:Card Grid.Row="2" Margin="8" Padding="16">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Grid Grid.Row="0">
                            <TextBlock Text="Alarms" FontSize="16" FontWeight="Medium"/>
                            <TextBlock x:Name="AlarmCountText" Text="(0 Active)" Margin="60,0,0,0" VerticalAlignment="Center" Foreground="Red"/>
                            <Button x:Name="ClearAlarmsButton" Content="CLEAR" HorizontalAlignment="Right" 
                                    Background="Transparent" BorderThickness="0" Click="ClearAlarmsButton_Click"/>
                        </Grid>
                        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,8,0,0">
                            <ItemsControl x:Name="AlarmsItemsControl">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding Background}" Margin="0,2" Padding="8,4" CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <materialDesign:PackIcon Kind="{Binding Icon}" 
                                                                        Foreground="{Binding IconColor}" 
                                                                        Margin="0,0,8,0" VerticalAlignment="Center"/>
                                                <StackPanel Grid.Column="1">
                                                    <TextBlock Text="{Binding AlarmId, StringFormat='Alarm {0}'}" FontWeight="Bold" FontSize="11"/>
                                                    <TextBlock Text="{Binding AlarmText}" FontSize="10" TextWrapping="Wrap"/>
                                                    <TextBlock Text="{Binding Timestamp}" FontSize="9" Foreground="Gray"/>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </materialDesign:Card>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2">
            <StatusBarItem>
                <TextBlock x:Name="ConnectionStatusText" Text="Disconnected"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="MessageCountText" Text="Messages: 0"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="LastMessageText" Text="Last: None"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="TimeText" Text="00:00:00"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>