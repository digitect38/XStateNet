<Window x:Class="SemiStandard.Simulator.Wpf.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SemiStandard.Simulator.Wpf"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="SEMI Equipment Simulator" Height="1080" Width="1920"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        TextElement.FontWeight="Regular"
        TextElement.FontSize="13"
        TextOptions.TextFormattingMode="Ideal"
        TextOptions.TextRenderingMode="Auto"
        FontFamily="{DynamicResource MaterialDesignFont}"
        WindowStartupLocation="CenterScreen">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <materialDesign:ColorZone Grid.Row="0" Mode="PrimaryDark" Padding="16" materialDesign:ElevationAssist.Elevation="Dp4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Chip" Width="32" Height="32" VerticalAlignment="Center" Margin="0,0,16,0"/>
                    <TextBlock Text="SEMI Equipment Simulator" VerticalAlignment="Center" Style="{StaticResource MaterialDesignHeadline5TextBlock}"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <TextBlock x:Name="ConnectionStatus" Text="DISCONNECTED" VerticalAlignment="Center" Margin="0,0,16,0" FontWeight="Bold"/>
                    <materialDesign:PackIcon x:Name="ConnectionIcon" Kind="LanDisconnect" Width="24" Height="24" VerticalAlignment="Center" Foreground="{StaticResource ErrorBrush}"/>
                </StackPanel>
            </Grid>
        </materialDesign:ColorZone>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel - State Machines -->
            <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto" Margin="8">
                <StackPanel>
                    <TextBlock Text="State Machines" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="8,8,8,16"/>
                    
                    <!-- E30 GEM State Machine Card -->
                    <materialDesign:Card Margin="8" materialDesign:ElevationAssist.Elevation="Dp2">
                        <Expander Header="E30 GEM State Machine">
                            <Grid Margin="16,8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="State:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E30State" Text="disabled" Foreground="{StaticResource AccentBrush}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Status:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E30Status" Text="Offline"/>
                                </StackPanel>

                                <ProgressBar Grid.Row="2" x:Name="E30Progress" Margin="0,8" Height="4" IsIndeterminate="False"/>
                                
                                <WrapPanel Grid.Row="3" Margin="0,8">
                                    <Button x:Name="E30Enable" Content="Enable" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E30Disable" Content="Disable" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E30Select" Content="Select" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                </WrapPanel>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>

                    <!-- E87 Carrier State Machine Card -->
                    <materialDesign:Card Margin="8" materialDesign:ElevationAssist.Elevation="Dp2">
                        <Expander Header="E87 Carrier State Machine">
                            <Grid Margin="16,8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="State:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E87State" Text="NotPresent" Foreground="{StaticResource AccentBrush}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Carrier ID:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E87CarrierId" Text="None"/>
                                </StackPanel>

                                <WrapPanel Grid.Row="2" Margin="0,8">
                                    <Button x:Name="E87Detect" Content="Detect Carrier" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E87Remove" Content="Remove" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E87Map" Content="Map" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                </WrapPanel>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>

                    <!-- E94 Control Job State Machine Card -->
                    <materialDesign:Card Margin="8" materialDesign:ElevationAssist.Elevation="Dp2">
                        <Expander Header="E94 Control Job State Machine">
                            <Grid Margin="16,8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="State:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E94State" Text="NoJob" Foreground="{StaticResource AccentBrush}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Job ID:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="E94JobId" Text="None"/>
                                </StackPanel>

                                <WrapPanel Grid.Row="2" Margin="0,8">
                                    <Button x:Name="E94Create" Content="Create Job" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E94Start" Content="Start" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="E94Abort" Content="Abort" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                </WrapPanel>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>

                    <!-- HSMS State Machine Card -->
                    <materialDesign:Card Margin="8" materialDesign:ElevationAssist.Elevation="Dp2">
                        <Expander Header="E37 HSMS Session">
                            <Grid Margin="16,8">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="State:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="HSMSState" Text="NotConnected" Foreground="{StaticResource AccentBrush}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Type:" FontWeight="Bold" Width="80"/>
                                    <TextBlock x:Name="HSMSType" Text="Passive"/>
                                </StackPanel>

                                <WrapPanel Grid.Row="2" Margin="0,8">
                                    <Button x:Name="HSMSConnect" Content="Connect" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                    <Button x:Name="HSMSDisconnect" Content="Disconnect" Margin="2" Style="{StaticResource MaterialDesignFlatButton}" Height="32"/>
                                </WrapPanel>
                            </Grid>
                        </Expander>
                    </materialDesign:Card>
                </StackPanel>
            </ScrollViewer>

            <!-- Center Panel - Message Log and Controls -->
            <Grid Grid.Column="1" Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200"/>
                </Grid.RowDefinitions>

                <!-- Quick Commands -->
                <materialDesign:Card Grid.Row="0" Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                    <StackPanel>
                        <TextBlock Text="Quick Commands" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                        <WrapPanel>
                            <Button x:Name="SendS1F1" Content="S1F1 (Are You There)" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button x:Name="SendS1F13" Content="S1F13 (Establish Comm)" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button x:Name="SendS1F17" Content="S1F17 (Request Online)" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button x:Name="SendS2F41" Content="S2F41 (Host Command)" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button x:Name="SendS6F11" Content="S6F11 (Event Report)" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                        </WrapPanel>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Message Log -->
                <materialDesign:Card Grid.Row="1" Margin="8" materialDesign:ElevationAssist.Elevation="Dp2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" Background="{StaticResource SecondaryBackgroundBrush}" Padding="16,8">
                            <Grid>
                                <TextBlock Text="Message Log" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" HorizontalAlignment="Left"/>
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button x:Name="ClearLog" Content="Clear" Style="{StaticResource MaterialDesignFlatButton}"/>
                                    <Button x:Name="ExportLog" Content="Export" Style="{StaticResource MaterialDesignFlatButton}"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                        
                        <ScrollViewer Grid.Row="1" x:Name="LogScrollViewer" VerticalScrollBarVisibility="Auto">
                            <ItemsControl x:Name="MessageLog" Margin="8">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,0,1" Padding="8,4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="120"/>
                                                    <ColumnDefinition Width="60"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding Timestamp}" Foreground="{StaticResource MaterialDesignBodyLight}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Direction}" FontWeight="Bold"/>
                                                <TextBlock Grid.Column="2" Text="{Binding Message}" TextWrapping="Wrap"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Grid>
                </materialDesign:Card>

                <!-- Custom Message Builder -->
                <materialDesign:Card Grid.Row="3" Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Custom Message" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                        
                        <Grid Grid.Row="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <TextBox Grid.Column="0" x:Name="StreamInput" materialDesign:HintAssist.Hint="Stream" Margin="4" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" x:Name="FunctionInput" materialDesign:HintAssist.Hint="Function" Margin="4" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="2" x:Name="DataInput" materialDesign:HintAssist.Hint="Data (Hex or Text)" Margin="4" VerticalAlignment="Center"/>
                            <Button Grid.Column="3" x:Name="SendCustom" Content="Send" Margin="4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                        </Grid>
                    </Grid>
                </materialDesign:Card>
            </Grid>

            <!-- Right Panel - Statistics and Charts -->
            <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto" Margin="8">
                <StackPanel>
                    <TextBlock Text="Statistics" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="8,8,8,16"/>
                    
                    <!-- Connection Statistics -->
                    <materialDesign:Card Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                        <StackPanel>
                            <TextBlock Text="Connection" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="IP Address:" Margin="0,2"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="IpAddress" Text="127.0.0.1" FontWeight="Bold" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" Margin="0,2"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="Port" Text="5000" FontWeight="Bold" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Device ID:" Margin="0,2"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="DeviceId" Text="0" FontWeight="Bold" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Session ID:" Margin="0,2"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" x:Name="SessionId" Text="N/A" FontWeight="Bold" Margin="0,2"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Message Statistics -->
                    <materialDesign:Card Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                        <StackPanel>
                            <TextBlock Text="Messages" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="120"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Row="0" Grid.Column="0" Text="Sent:" Margin="0,2"/>
                                <TextBlock Grid.Row="0" Grid.Column="1" x:Name="MessagesSent" Text="0" FontWeight="Bold" Foreground="{StaticResource SuccessBrush}" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="1" Grid.Column="0" Text="Received:" Margin="0,2"/>
                                <TextBlock Grid.Row="1" Grid.Column="1" x:Name="MessagesReceived" Text="0" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="2" Grid.Column="0" Text="Errors:" Margin="0,2"/>
                                <TextBlock Grid.Row="2" Grid.Column="1" x:Name="MessageErrors" Text="0" FontWeight="Bold" Foreground="{StaticResource ErrorBrush}" Margin="0,2"/>
                                
                                <TextBlock Grid.Row="3" Grid.Column="0" Text="Avg Response:" Margin="0,2"/>
                                <TextBlock Grid.Row="3" Grid.Column="1" x:Name="AvgResponse" Text="0 ms" FontWeight="Bold" Margin="0,2"/>
                            </Grid>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Message Rate Chart -->
                    <materialDesign:Card Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                        <StackPanel>
                            <TextBlock Text="Message Rate" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                            <lvc:CartesianChart x:Name="MessageRateChart" Height="150"/>
                        </StackPanel>
                    </materialDesign:Card>

                    <!-- Control Buttons -->
                    <materialDesign:Card Margin="8" Padding="16" materialDesign:ElevationAssist.Elevation="Dp2">
                        <StackPanel>
                            <TextBlock Text="Control" Style="{StaticResource MaterialDesignSubtitle1TextBlock}" Margin="0,0,0,8"/>
                            <Button x:Name="StartSimulator" Content="Start Simulator" Margin="0,4" Style="{StaticResource MaterialDesignRaisedButton}"/>
                            <Button x:Name="StopSimulator" Content="Stop Simulator" Margin="0,4" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                            <Button x:Name="ResetStates" Content="Reset All States" Margin="0,4" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                            <Button x:Name="LoadScenario" Content="Load Scenario" Margin="0,4" Style="{StaticResource MaterialDesignFlatButton}"/>
                            <Button x:Name="SaveScenario" Content="Save Scenario" Margin="0,4" Style="{StaticResource MaterialDesignFlatButton}"/>
                        </StackPanel>
                    </materialDesign:Card>
                </StackPanel>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="2" Background="{StaticResource SecondaryBackgroundBrush}">
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Information" Margin="0,0,4,0" VerticalAlignment="Center"/>
                    <TextBlock x:Name="StatusMessage" Text="Ready" VerticalAlignment="Center"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock x:Name="UptimeStatus" Text="Uptime: 00:00:00"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock x:Name="TimeStatus" Text="{Binding Source={x:Static sys:DateTime.Now}, StringFormat='HH:mm:ss'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>